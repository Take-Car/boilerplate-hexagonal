version: '3'

silent: true
output: 'prefixed'

includes:
  docker: ./docker.yaml

tasks:
  install:
    desc: Install frontend dependencies
    cmds:
      - docker compose run --rm node yarn install --pure-lockfile
    sources:
      - apps/web/package.json
      - apps/web/yarn.lock
    generates:
      - apps/web/node_modules/**/*

  graphql:
    desc: Generate typed hooks
    cmds:
      - docker compose run --rm node yarn graphql:generate
    sources:
      - apps/api/Application/GraphQL/**/*.php
      - apps/web/codegen.yml
    generates:
      - apps/web/src/hooks/graphql.ts
  
  eslint:
    desc: Run ESLint
    cmds:
      - docker compose run --rm node yarn eslint --fix
  
  typescript:
    desc: Check type hinting
    cmds:
      - docker compose run --rm node yarn tsc --noEmit
  
  lint:
    desc: Lint files (ESLint, TypeScript)
    cmds:
      - task: eslint
      - task: typescript